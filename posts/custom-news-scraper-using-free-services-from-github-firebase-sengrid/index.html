<!doctype html><html dir=ltr lang=en data-theme=dark><head>
<title>
Mark Chmarny
|
Custom news scraper using free services from GitHub, Firebase, and Sengrid
</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.91.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name=description content="
      few longer thoughts, <br/>because every once in a while <br/>140 characters is just not enough


    ">
<link rel=stylesheet href=/css/main.min.572e5d22a390a981698b5def60302e86c9be929e5f6b0d4df3a4670429bb4f51.css integrity="sha256-Vy5dIqOQqYFpi13vYDAuhsm+kp5faw1N86RnBCm7T1E=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/css/markupHighlight.min.058b31f17db60602cc415fd63b0427e7932fbf35c70d8e341a4c39385f5f6f3e.css integrity="sha256-BYsx8X22BgLMQV/WOwQn55MvvzXHDY40Gkw5OF9fbz4=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/css/custom.min.59c9cafff576ceb7f4d77dbd930858fe4bb329e64af97cd63e84077a2efd86f2.css integrity="sha256-WcnK//V2zrf01329kwhY/kuzKeZK+XzWPoQHei79hvI=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous>
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Roboto:ital,wght@0,100;0,400;0,700;1,400&display=swap" rel=stylesheet>
<link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon>
<link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png>
<link rel=canonical href=https://blog.chmarny.com/posts/custom-news-scraper-using-free-services-from-github-firebase-sengrid/>
<script type=text/javascript src=/js/anatole-header.min.2a2cd9614b7d007dfbb75e8da19e3a0fa872ceab53c6d000c00b7a0c89b85bfc.js integrity="sha256-KizZYUt9AH37t16NoZ46D6hyzqtTxtAAwAt6DIm4W/w=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus=" crossorigin=anonymous></script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.chmarny.com/images/site-feature-image.png">
<meta name=twitter:title content="Custom news scraper using free services from GitHub, Firebase, and Sengrid">
<meta name=twitter:description content="Increasing large amount of technical news I read come from the posts shared on Hacker News or on Twitter. While both of these services have search options, neither of these seem to be advanced enough to narrow my searches at the desired level or to setup automatic delivery.">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Custom news scraper using free services from GitHub, Firebase, and Sengrid","headline":"Custom news scraper using free services from GitHub, Firebase, and Sengrid","alternativeHeadline":"","description":"
      
        Increasing large amount of technical news I read come from the posts shared on Hacker News or on Twitter. While both of these services have search options, neither of these seem to be advanced enough to narrow my searches at the desired level or to setup automatic delivery.


      


    ","inLanguage":"en","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.chmarny.com\/posts\/custom-news-scraper-using-free-services-from-github-firebase-sengrid\/"},"author":{"@type":"Person","name":"Mark Chmarny"},"creator":{"@type":"Person","name":"Mark Chmarny"},"accountablePerson":{"@type":"Person","name":"Mark Chmarny"},"copyrightHolder":{"@type":"Person","name":"Mark Chmarny"},"copyrightYear":"2021","dateCreated":"2021-04-05T01:09:03.15Z","datePublished":"2021-04-05T01:09:03.15Z","dateModified":"2021-04-05T01:09:03.15Z","publisher":{"@type":"Organization","name":"Mark Chmarny","url":"https://blog.chmarny.com","logo":{"@type":"ImageObject","url":"https:\/\/blog.chmarny.com\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":["https://blog.chmarny.com/images/site-feature-image.png"],"url":"https:\/\/blog.chmarny.com\/posts\/custom-news-scraper-using-free-services-from-github-firebase-sengrid\/","wordCount":"611","genre":["oss","serverless","dev","news","howto"],"keywords":[]}</script>
</head>
<body>
<header><div class="page-top
.">
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
</a>
<nav>
<ul class=nav__list id=navMenu>
<div class=nav__links>
<li>
<a href=/ title>Home</a>
</li>
<li>
<a href=/posts/ title>Posts</a>
</li>
<li>
<a href=/about/ title>About</a>
</li>
</div>
<ul>
<li>
<a class=theme-switch title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a>
</li>
</ul>
</ul>
</nav>
</div>
</header>
<div class=wrapper>
<aside><div class="sidebar
.">
<div class=sidebar__content>
<div class=logo-title>
<div class=title>
<img src=/images/profile.png alt="profile picture">
<h3 title><a href=/>Mark Chmarny</a></h3>
<div class=description>
<p>few longer thoughts, <br>because every once in a while <br>140 characters is just not enough</p>
</div>
</div>
</div>
<ul class=social-links>
<li>
<a href=https://twitter.com/mchmarny rel=me aria-label=Twitter title=Twitter>
<i class="fab fa-twitter fa-2x" aria-hidden=true></i>
</a>
</li>
<li>
<a href=https://github.com/mchmarny rel=me aria-label=GitHub title=GitHub>
<i class="fab fa-github fa-2x" aria-hidden=true></i>
</a>
</li>
<li>
<a href=https://speakerdeck.com/mchmarny rel=me aria-label="Speaker Deck" title="Speaker Deck">
<i class="fas fa-file-powerpoint fa-2x" aria-hidden=true></i>
</a>
</li>
<li>
<a href=mailto:blog@chmarny.com rel=me aria-label=e-mail title=e-mail>
<i class="fas fa-envelope fa-2x" aria-hidden=true></i>
</a>
</li>
</ul>
</div><footer class="footer footer--sidebar">
<div class=by_farbox>
<ul class=footer__list>
<li class=footer__item>
&copy;2022
</li>
</ul>
</div>
</footer>
<script type=text/javascript src=/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I=" crossorigin=anonymous></script></div>
</aside>
<main>
<div class=autopagerize_page_element>
<div class=content>
<div class="post
.">
<div class=post-content>
<img class=post-thumbnail src=/images/news.png alt="Thumbnail image">
<div class=post-title>
<h1>Custom news scraper using free services from GitHub, Firebase, and Sengrid</h1>
</div><p>Increasing large amount of technical news I read come from the posts shared on Hacker News or on Twitter. While both of these services have <a href=https://help.twitter.com/en/using-twitter/twitter-advanced-search>search options</a>, neither of these seem to be advanced enough to narrow my searches at the desired level or to setup automatic delivery.</p>
<p>I decided to write my own using a few of the on-line services that come with generous free-tier option:</p>
<ul>
<li>First, <strong>the runtime</strong>. I’ve been impressed with the flexibility of <a href=https://github.com/features/actions>GitHub Actions</a>. While actions are normally written in JavaScript, with its support for pre-built Docker images, I decided to write my service in Go.</li>
<li>To <strong>persist the state</strong> between each execution (GitHub Actions are ephemeral by nature) I’ve used <a href=https://firebase.google.com/docs/firestore/>Firestore</a> (part of Firebase service), which has been my goto serverless &ldquo;database&rdquo; for a while now due to its easy API, schema-less design, and generous <a href=https://firebase.google.com/pricing/>free plan</a> (1GB, 50K reads and 20K writes per day).</li>
<li>Finally, to deliver the matching results, I’ve chosen the <strong>e-mail sending service</strong> offered by <a href=https://sendgrid.com>SendGrid</a>. Again, simple API and super easy configuration with up to <a href=https://sendgrid.com/pricing/>100 free emails</a> per day.</li>
</ul>
<p>With the services selected, I wrote a <a href=https://github.com/mchmarny/gaw>simple application</a> that builds the desired queries against the Hacker News and Twitter API, filters out results based on provided criteria, and captures the final state of each query for subsequent queries. The application builds into a Docker image using, you guest it, GitHub Actions. The entire source code and the automation around the project are located <a href=https://github.com/mchmarny/gaw>here</a>.</p>
<h2 id=delivery-schedule>Delivery schedule</h2>
<p>You can setup your searches in a private repository, this keeps the topics to which you subscribe and your email address hidden. Start by <a href=https://docs.github.com/en/actions/quickstart>creating an action</a> with <code>on</code> schedule matching your desired delivery times. For example (15 min after noon, 5 and 11PM GMT):</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>on</span><span class=p>:</span><span class=w>  
</span><span class=w>  </span><span class=nt>schedule</span><span class=p>:</span><span class=w>  
</span><span class=w>  </span>- <span class=nt>cron</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;15 12,17,23 \* \* \*&#34;</span><span class=w>
</span></code></pre></div><p>Next, define any number of steps in your <code>job</code>, each with the source type parameter and the query which you want to schedule. For example, to search for most recent not retweets in English on Kubernetes, DevOps, or CI/CD that have links, were shared by people who themselves posted more than 200 tweets, have at least 500 followers, and have a low following (friend) to follower ratio the schedule would look something like this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Twitter Search  </span><span class=w>
</span><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker://ghcr.io/mchmarny/gaw:v0.2.9  </span><span class=w>
</span><span class=w>  </span><span class=nt>with</span><span class=p>:</span><span class=w>  
</span><span class=w>    </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class=l>twitter  </span><span class=w>
</span><span class=w>    </span><span class=nt>query</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes OR devops OR ci/cd  </span><span class=w>
</span><span class=w>    </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=l>you@your-domain.com  </span><span class=w>
</span><span class=w>    </span><span class=nt>subject</span><span class=p>:</span><span class=w> </span><span class=l>Tweets about k8s, devops, or ci/cd  </span><span class=w>
</span><span class=w>    </span><span class=nt>email-config</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.EMAIL\_CONFIG }}  </span><span class=w>
</span><span class=w>    </span><span class=nt>state-config</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.FIRESTORE\_CONFIG }}  </span><span class=w>
</span><span class=w>    </span><span class=nt>twitter-config</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.TWITTER\_CONFIG }}  </span><span class=w>
</span><span class=w>    </span><span class=nt>lang</span><span class=p>:</span><span class=w> </span><span class=l>en</span><span class=w> </span><span class=c># language (en == English)  </span><span class=w>
</span><span class=w>    </span><span class=nt>latest</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># most recent popular  </span><span class=w>
</span><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># must have links  </span><span class=w>
</span><span class=w>    </span><span class=nt>followers</span><span class=p>:</span><span class=w> </span><span class=m>500</span><span class=w> </span><span class=c># min number of followers  </span><span class=w>
</span><span class=w>    </span><span class=nt>retweets</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=c># Include retweets  </span><span class=w>
</span><span class=w>    </span><span class=nt>posts</span><span class=p>:</span><span class=w> </span><span class=m>200</span><span class=w> </span><span class=c># min number of posts  </span><span class=w>
</span><span class=w>    </span><span class=nt>ratio</span><span class=p>:</span><span class=w> </span><span class=m>0.1</span><span class=w> </span><span class=c># number of friends/number of followers</span><span class=w>
</span></code></pre></div><p>Notice that the API tokens and other secrets are using encrypted environment variables provided by <a href=https://docs.github.com/en/actions/reference/encrypted-secrets>GitHub secrets</a>. The instructions on how to configure these are located <a href=https://github.com/mchmarny/gaw#setup>here</a>.</p>
<p>The full examples of schedules are available in the repo:</p>
<ul>
<li><a href=https://github.com/mchmarny/gaw/blob/main/.github/workflows/schedule-hn.yaml>Hacker News search example</a></li>
<li><a href=https://github.com/mchmarny/gaw/blob/main/.github/workflows/schedule-tw.yaml>Twitter search example</a></li>
</ul>
<h4 id=delivery-dispatch>Delivery dispatch</h4>
<p>In addition to scheduled queries, you can also set up on-demand searches for specific topic. In this case we combine the Twitter and Hacker News sources into a single workflow with an <code>on</code> action set to repo dispatch:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=nt>on</span><span class=p>:</span><span class=w>  
</span><span class=w>  </span><span class=nt>repository_dispatch</span><span class=p>:</span><span class=w>  
</span><span class=w>    </span><span class=nt>types</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>search]</span><span class=w>
</span></code></pre></div><p>The full example of this workflow is available <a href=https://github.com/mchmarny/gaw/blob/main/.github/workflows/dispatch-on-topic.yaml>here</a>. When configured, the specific topic (e.g. golang) for which you want to search can be defined in a command line:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>curl -H <span class=s2>&#34;Accept: application/vnd.github.v3+json&#34;</span> <span class=se>\\</span>  
     -H <span class=s2>&#34;Authorization: token </span><span class=si>${</span><span class=nv>GITHUB</span><span class=se>\_</span><span class=nv>TOKEN</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\\</span>  
     https://api.github.com/repos/&lt;username&gt;/&lt;repo&gt;/dispatches <span class=se>\\</span>  
     -d <span class=s1>&#39;{ &#34;event\_type&#34;: &#34;search&#34;, &#34;client\_payload&#34;: { &#34;topic&#34;:&#34;golang&#34; }}&#39;</span>
</code></pre></div><p>To execute the dispatches using HTTP API you will need GitHub personal access token. The instructions how to create one are located <a href=https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token>here</a>.</p>
<h2 id=email-notifications>Email Notifications</h2>
<p>Whether you executed the workflow on schedule or using the HTTP dispatch, the delivered email looks something like this:</p>
<p><img src=/images/1__hXVNbQCMeQ__u1Ue3zueplA.png alt="Workflow Notification"></p>
<p>Hope you found this helpful,</p>
</div>
<div class=post-footer>
<div class=info>
<span class=separator><a class=category href=/categories/oss/>oss</a><a class=category href=/categories/serverless/>serverless</a><a class=category href=/categories/dev/>dev</a><a class=category href=/categories/news/>news</a><a class=category href=/categories/howto/>howto</a></span>
</div>
</div>
</div>
</div>
</div>
</main>
</div><footer class="footer footer--base">
<div class=by_farbox>
<ul class=footer__list>
<li class=footer__item>
&copy;2022
</li>
</ul>
</div>
</footer>
<script type=text/javascript src=/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I=" crossorigin=anonymous></script></body>
</html>