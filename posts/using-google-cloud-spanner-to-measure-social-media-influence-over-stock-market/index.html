<!doctype html><html lang=en dir=auto data-theme=dark><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Google Cloud Spanner to measure social media influence over stock market | Mark Chmarny</title><meta name=keywords content="spanner,twitter,dev,go,sql"><meta name=description content="I wanted to use the now generally available Cloud Spanner database to write an app that would track stock prices and social media sentiment to identify potential correlation.

To test even the validity of this approach I put together a Go app that subscribes to Twitter stream for all companies defined in the Stocks table and scores each event against the Google NLP API while comparing the user sentiment against the stock ask price against Yahoo API."><meta name=author content="Mark Chmarny"><link rel=canonical href=https://blog.chmarny.com/posts/using-google-cloud-spanner-to-measure-social-media-influence-over-stock-market/><link crossorigin=anonymous href=/assets/css/stylesheet.5bef4b698d33ee9d58f22269d129fe3c725b1b3356a4ed1ded10651b773f88c5.css integrity="sha256-W+9LaY0z7p1Y8iJp0Sn+PHJbGzNWpO0d7RBlG3c/iMU=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chmarny.com/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chmarny.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chmarny.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chmarny.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.chmarny.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chmarny.com/posts/using-google-cloud-spanner-to-measure-social-media-influence-over-stock-market/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="light"&&(document.querySelector("html").dataset.theme="light")</script><meta property="og:url" content="https://blog.chmarny.com/posts/using-google-cloud-spanner-to-measure-social-media-influence-over-stock-market/"><meta property="og:site_name" content="Mark Chmarny"><meta property="og:title" content="Using Google Cloud Spanner to measure social media influence over stock market"><meta property="og:description" content="I wanted to use the now generally available Cloud Spanner database to write an app that would track stock prices and social media sentiment to identify potential correlation.
To test even the validity of this approach I put together a Go app that subscribes to Twitter stream for all companies defined in the Stocks table and scores each event against the Google NLP API while comparing the user sentiment against the stock ask price against Yahoo API."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-05-16T15:51:12+00:00"><meta property="article:modified_time" content="2017-05-16T15:51:12+00:00"><meta property="article:tag" content="Spanner"><meta property="article:tag" content="Twitter"><meta property="article:tag" content="Dev"><meta property="article:tag" content="Go"><meta property="article:tag" content="Sql"><meta property="og:image" content="https://blog.chmarny.com/images/site-feature-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chmarny.com/images/site-feature-image.png"><meta name=twitter:title content="Using Google Cloud Spanner to measure social media influence over stock market"><meta name=twitter:description content="I wanted to use the now generally available Cloud Spanner database to write an app that would track stock prices and social media sentiment to identify potential correlation.

To test even the validity of this approach I put together a Go app that subscribes to Twitter stream for all companies defined in the Stocks table and scores each event against the Google NLP API while comparing the user sentiment against the stock ask price against Yahoo API."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chmarny.com/posts/"},{"@type":"ListItem","position":2,"name":"Using Google Cloud Spanner to measure social media influence over stock market","item":"https://blog.chmarny.com/posts/using-google-cloud-spanner-to-measure-social-media-influence-over-stock-market/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Google Cloud Spanner to measure social media influence over stock market","name":"Using Google Cloud Spanner to measure social media influence over stock market","description":"I wanted to use the now generally available Cloud Spanner database to write an app that would track stock prices and social media sentiment to identify potential correlation.\nTo test even the validity of this approach I put together a Go app that subscribes to Twitter stream for all companies defined in the Stocks table and scores each event against the Google NLP API while comparing the user sentiment against the stock ask price against Yahoo API.\n","keywords":["spanner","twitter","dev","go","sql"],"articleBody":"I wanted to use the now generally available Cloud Spanner database to write an app that would track stock prices and social media sentiment to identify potential correlation.\nTo test even the validity of this approach I put together a Go app that subscribes to Twitter stream for all companies defined in the Stocks table and scores each event against the Google NLP API while comparing the user sentiment against the stock ask price against Yahoo API.\nThe app uses event author’s (tweet in case of Twitter) follower and post counts to define the weights of influence and “credits” them for positive influence when stock price moves up or negative stock when the stock moves down within an hour of their post.\nOverall great experience, a couple of things I had to work around that may be helpful to others.\nDDL Loading well-formed DDL into spanner instance through the gcloud CLI was little of a challenge. Looks like you have to send one continuous string for each DLL command. I wanted to maintain the DB schema in a human readable format and minimize the amount of “stitching” I would have to do to recreate the environment so I put together this script. It parses through the DDL above and executes schema create scripts in the way that gcloud CLI likes.\nReports Ideally my app would come with some UI but in the mean time I needed to run some queries to understand the different correlations. The JDBC Drivers for Cloud Spanner works great from Java but it took me a while to find a DB Explorer/Query type of tool that would be able to load the driver and connect using GCloud credential file.\nIt didn’t take me too long to find DBeaver. it loaded the 4.2 JDBC compatible version of Spanner driver and connect to my Spanner instance… including schema discovery!. Make sure you have the GOOGLE_APPLICATION_CREDENTIALS environment variable defined with path to your service account credential file.\nThe app code along with the docker/GKE deployment scripts are available in GitHub repo.\n","wordCount":"342","inLanguage":"en","image":"https://blog.chmarny.com/images/site-feature-image.png","datePublished":"2017-05-16T15:51:12.061Z","dateModified":"2017-05-16T15:51:12.061Z","author":{"@type":"Person","name":"Mark Chmarny"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chmarny.com/posts/using-google-cloud-spanner-to-measure-social-media-influence-over-stock-market/"},"publisher":{"@type":"Organization","name":"Mark Chmarny","logo":{"@type":"ImageObject","url":"https://blog.chmarny.com/favicons/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.chmarny.com/ accesskey=h title="Mark Chmarny (Alt + H)">Mark Chmarny</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chmarny.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://blog.chmarny.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.chmarny.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://blog.chmarny.com/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://blog.chmarny.com/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.chmarny.com/>Home</a>&nbsp;»&nbsp;<a href=https://blog.chmarny.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Using Google Cloud Spanner to measure social media influence over stock market</h1><div class=post-meta><span title='2017-05-16 15:51:12.061 +0000 UTC'>2017-05-16</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>Mark Chmarny</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ddl aria-label=DDL>DDL</a></li><li><a href=#reports aria-label=Reports>Reports</a></li></ul></div></details></div><div class=post-content><p>I wanted to use the <a href=https://cloudplatform.googleblog.com/2017/05/Cloud-Spanner-is-now-production-ready-let-the-migrations-begin.html>now generally available Cloud Spanner</a> database to write an app that would track stock prices and social media sentiment to identify potential correlation.</p><p><img loading=lazy src=/images/1__xGWhGM____d__LluxeXMRBpmg.png></p><p>To test even the validity of this approach I put together a Go app that subscribes to Twitter stream for all companies defined in the <code>Stocks</code> table and scores each event against the <a href=https://cloud.google.com/natural-language/>Google NLP API</a> while comparing the user sentiment against the stock ask price against Yahoo API.</p><p><img loading=lazy src=/images/1__KoAeJf5QAV__pC2i6Tn3kBA.png></p><p>The app uses event author’s (tweet in case of Twitter) follower and post counts to define the weights of influence and &ldquo;credits&rdquo; them for positive influence when stock price moves up or negative stock when the stock moves down within an hour of their post.</p><p>Overall great experience, a couple of things I had to work around that may be helpful to others.</p><h2 id=ddl>DDL<a hidden class=anchor aria-hidden=true href=#ddl>#</a></h2><p>Loading well-formed DDL into spanner instance through the <a href=https://cloud.google.com/sdk/downloads>gcloud</a> CLI was little of a challenge. Looks like you have to send one continuous string for each DLL command. I wanted to maintain the DB schema in a human readable format and minimize the amount of &ldquo;stitching&rdquo; I would have to do to recreate the environment so I put together <a href=https://github.com/mchmarny/tsignal/blob/master/scripts/setup.sh>this script</a>. It parses through the DDL above and executes schema create scripts in the way that gcloud CLI likes.</p><p><img loading=lazy src=/images/1__abph6Y2peKec5gn5tx6WyQ.png></p><h2 id=reports>Reports<a hidden class=anchor aria-hidden=true href=#reports>#</a></h2><p>Ideally my app would come with some UI but in the mean time I needed to run some queries to understand the different correlations. The <a href=https://cloud.google.com/spanner/docs/partners/drivers>JDBC Drivers for Cloud Spanner</a> works great from Java but it took me a while to find a DB Explorer/Query type of tool that would be able to load the driver and connect using GCloud credential file.</p><p><img loading=lazy src=/images/1__NGQheSx0VcZ8bLCs0Lc9fQ.png></p><p>It didn’t take me too long to find <a href=http://dbeaver.jkiss.org/>DBeaver</a>. it loaded the 4.2 JDBC compatible version of Spanner driver and connect to my Spanner instance… including schema discovery!. Make sure you have the GOOGLE_APPLICATION_CREDENTIALS environment variable defined with path to your service account credential file.</p><p><img loading=lazy src=/images/1__onXRSbsuS5ILkQy33IoYzg.png></p><p>The app code along with the docker/GKE deployment scripts are available in <a href=https://github.com/mchmarny/tsignal>GitHub repo</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chmarny.com/tags/spanner/>Spanner</a></li><li><a href=https://blog.chmarny.com/tags/twitter/>Twitter</a></li><li><a href=https://blog.chmarny.com/tags/dev/>Dev</a></li><li><a href=https://blog.chmarny.com/tags/go/>Go</a></li><li><a href=https://blog.chmarny.com/tags/sql/>Sql</a></li></ul><nav class=paginav><a class=prev href=https://blog.chmarny.com/posts/how-to-use-stackdriver-to-monitor-custom-application-metrics/><span class=title>« Prev</span><br><span>How to use Stackdriver to monitor custom application metrics</span>
</a><a class=next href=https://blog.chmarny.com/posts/twitter-sentiment-analysis-in-go-using-google-nlp/><span class=title>Next »</span><br><span>Twitter Sentiment Analysis in Go using Google NLP API</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://blog.chmarny.com/>Mark Chmarny</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>